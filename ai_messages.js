// =====================================
// AI MESSAGE GENERATION SYSTEM
// =====================================

/**
 * Message templates for different AI personalities and situations
 */

const MESSAGE_TEMPLATES = {
    // === WAR MESSAGES ===
    attack: {
        threatening: [
            '×”×¦×‘× ×©×œ×™ ×‘×“×¨×š ××œ×™×š! ðŸ—¡ï¸',
            '×”×ª×›×•× ×Ÿ ×œ×”×’× ×”, {target}!',
            '×”×’×™×¢ ×”×–×ž×Ÿ ×œ×”×¨××•×ª ×œ×š ×ž×™ ×”×©×œ×™×˜ ×›××Ÿ!',
            '×©×˜×—×š ×™×”×™×” ×©×œ×™ ×‘×§×¨×•×‘...',
            '×× ×™ ×ž×’×™×¢ ×¢× ×¦×‘×! âš”ï¸',
            '×”×™×©××¨ ×‘×ž×§×•×ž×š - ×–×” ×œ× ×™×§×— ×”×¨×‘×” ×–×ž×Ÿ ðŸ˜ˆ'
        ],
        diplomatic: [
            '×ž×¦×˜×¢×¨, ××‘×œ ×× ×™ ×¦×¨×™×š ××ª ×”×ž×©××‘×™× ×©×œ×š',
            '×–×” ×œ× ××™×©×™, {target}',
            '×ž×§×•×•×” ×©×ª×‘×™×Ÿ - ×–×” ×¨×§ ×¢×¡×§×™×',
            '× ×¨××” ×ž×™ ×ž×•×›×Ÿ ×™×•×ª×¨ ×œ×§×¨×‘'
        ],
        friendly: [
            '×¡×œ×™×—×”, ××‘×œ ×× ×™ ×¦×¨×™×š ×œ×”×ª××ž×Ÿ...',
            '×‘×œ×™ ×¤×’×™×¢×•×ª ×¨×’×©×™×•×ª, × ×›×•×Ÿ? ðŸ˜…',
            '×ª×¨××” ×¢×œ ×–×” ×›×ª×¨×’×™×œ'
        ],
        cooperative: [
            '×–×” ×‘×©×‘×™×œ ×”×§×œ××Ÿ, ×ª×‘×™×Ÿ',
            '×¤×§×•×“×•×ª ×ž×œ×ž×¢×œ×”...',
            '×”×§×œ××Ÿ ×©×œ×™ ×¦×¨×™×š ××ª ×–×”'
        ]
    },

    victory: {
        threatening: [
            '× ×™×¦×—×•×Ÿ ×ž×ª×•×§! ðŸŽ‰ ×ª×•×“×” ×¢×œ ×”×©×œ×œ!',
            '×¦×‘× ×—×œ×©... × ×¡×” ×©× ×™×ª ×‘×¤×¢× ×”×‘××”',
            '×”×™×™×ª×” ×–×• ×§×¨×‘ ×§×œ×” ×ž×“×™',
            '×¢×™×¨ ×™×¤×” ×”×™×™×ª×” ×œ×š... ðŸ˜',
            '×ª×•×“×” ×¢×œ ×”×ž×©××‘×™×! ðŸ’°',
            '××•×œ×™ ×ª×©×“×¨×’ ××ª ×”×”×’× ×”?'
        ],
        diplomatic: [
            '×§×¨×‘ ×”×•×’×Ÿ. ×‘×”×¦×œ×—×” ×‘×¤×¢× ×”×‘××”',
            '×ª×•×“×” ×¢×œ ×”×ž×©×—×§, {target}',
            '××™×Ÿ ×ª×—×¨×•×ª ×‘×œ×™ ×ª×—×¨×•×ª ×˜×•×‘×”'
        ],
        friendly: [
            '×¡×œ×™×—×”! ×× ×™ ×ž×©×œ× ×‘×—×–×¨×” ×ž××•×—×¨ ×™×•×ª×¨ ðŸ˜Š',
            '×§×¨×‘ ×˜×•×‘!',
            '×ª×§×•×•×” ×©×œ× ×œ×§×—×ª×™ ×™×•×ª×¨ ×ž×“×™...'
        ],
        cooperative: [
            '×–×” ×”×™×” ×‘×©×‘×™×œ ×”×§×œ××Ÿ',
            '×”× ×™×¦×—×•×Ÿ ×©×™×™×š ×œ×›×•×œ× ×•',
            '×”×§×œ××Ÿ ×©×œ×™ ×™×”×™×” ×’××”'
        ]
    },

    defeat: {
        threatening: [
            '×–×” ×¢×•×“ ×œ× × ×’×ž×¨!',
            '××—×–×•×¨ ×—×–×§ ×™×•×ª×¨! ðŸ’ª',
            '× ×ª×¨××” ×‘×§×¨×•×‘...',
            '×–×” ×¨×§ ×”×ª×—×œ×”'
        ],
        diplomatic: [
            '×›×œ ×”×›×‘×•×“, {target}',
            '×–×›×™×ª ×”×¤×¢×',
            '×”×”×’× ×” ×©×œ×š ×˜×•×‘×”'
        ],
        friendly: [
            '×•×•××•, ××ª×” ×˜×•×‘! ðŸ‘',
            '×œ×ž×“×ª×™ ×ž×©×”×•',
            '×× ×™ ×¦×¨×™×š ×œ×©×¤×¨ ××ª ×”×¦×‘× ×©×œ×™'
        ],
        cooperative: [
            '×”×§×œ××Ÿ ×©×œ×™ ×™×¢×–×•×¨ ×œ×™',
            '×× ×™ ×—×•×–×¨ ×¢× ×—×™×–×•×§×™×',
            '×”×¤×¢× ×œ× ×”×œ×š ×˜×•×‘'
        ]
    },

    // === TRADE MESSAGES ===
    trade_offer: {
        friendly: [
            '×™×© ×œ×™ ×”×¦×¢×” ×˜×•×‘×” ×‘×©×‘×™×œ×š ×‘×©×•×§! ðŸ’¼',
            '×ž×¢×•× ×™×™×Ÿ ×‘×¢×¡×§×”? ×‘×“×•×§ ××ª ×”×”×¦×¢×” ×©×œ×™',
            '×¡×™×›×•× ×¨×•×•×—×™ ×œ×©× ×™× ×• - ×¨××” ×©×•×§ ðŸ’°',
            '×™×© ×œ×™ ×¢×•×“×¤×™×, ×¨×•×¦×” ×œ×¡×—×•×¨?'
        ],
        diplomatic: [
            '×”×¦×¢×ª ×ž×¡×—×¨ ×—×“×©×” ×‘×©×•×§',
            '×‘×“×•×§ ××ª ×”×”×¦×¢×” ×©×œ×™ ×‘×ž×¡×—×¨',
            '×™×© ×œ×™ ×ž×©×”×• ×©××•×œ×™ ×™×¢× ×™×™×Ÿ ××•×ª×š'
        ],
        cooperative: [
            '×”×§×œ××Ÿ ×©×œ×™ ×ž×¡×—×¨ - ×‘×•× ×ª×¨××”',
            '×™×© ×œ× ×• ×¢×¡×§×” ×˜×•×‘×” ×‘×©×•×§',
            '×ª×•×ž×š ×‘×—×‘×¨×™ ×§×œ××Ÿ - ×”× ×—×” ×ž×™×•×—×“×ª! ðŸ¤'
        ]
    },

    trade_accepted: {
        friendly: [
            '×ª×•×“×” ×¢×œ ×”×¢×¡×§×”! ðŸ¤',
            '× ×¢×™× ×œ×¢×©×•×ª ×¢×¡×§×™× ××™×ª×š!',
            '×ª×•×ª×” ×¨×‘×”, {target}!'
        ],
        diplomatic: [
            '×¢×¡×§×” ×”×•×©×œ×ž×”',
            '×ª×•×“×” ×¢×œ ×”×¡×—×¨',
            '× ×ž×©×™×š ×œ×¡×—×•×¨'
        ]
    },

    // === CLAN MESSAGES ===
    clan_invite: {
        cooperative: [
            '×¨×•×¦×” ×œ×”×¦×˜×¨×£ ×œ×§×œ××Ÿ ×©×œ× ×•? ðŸ°',
            '{clan} ×ž×—×¤×© ×—×‘×¨×™× ×—×“×©×™×!',
            '×”×¦×˜×¨×£ ××œ×™× ×• ×‘-{clan}!',
            '× ×©×ž×— ×× ×ª×¦×˜×¨×£ ×œ×§×œ××Ÿ {clan}'
        ],
        diplomatic: [
            '×ž×–×ž×™×Ÿ ××•×ª×š ×œ×§×œ××Ÿ {clan}',
            '×× ×—× ×• ×’×“×œ×™× - ×¨×•×¦×” ×œ×”×¦×˜×¨×£?'
        ]
    },

    clan_achievement: {
        cooperative: [
            '×”×§×œ××Ÿ {clan} ×‘× ×” ×ž×‘×¦×¨! ðŸ°',
            '{clan} ×”×’×™×¢ ×œ-{members} ×—×‘×¨×™×!',
            '×”×§×œ××Ÿ ×©×œ× ×• ×¢×•×œ×” ×‘×˜×‘×œ×ª ×”×“×™×¨×•×’! ðŸ†'
        ]
    },

    // === RANDOM CHAT ===
    random_chat: {
        friendly: [
            '××™×–×” ×™×•× ×™×¤×” ×œ×›×‘×•×© ×˜×¨×™×˜×•×¨×™×•×ª! â˜€ï¸',
            '×ž×™×©×”×• ×¨×•×¦×” ×œ×¡×—×•×¨ ×–×”×‘?',
            '×”×ž×©×—×§ ×”×–×” ×ž×ž×›×¨...',
            '×”×¢×™×¨ ×©×œ×™ ×’×“×œ×” ×ž×”×¨ ðŸ›ï¸',
            '×”×¦×‘× ×©×œ×™ ×’×“×œ ×ž×”×¨ ðŸ’ª',
            '×ž×™ ×™×© ×œ×• ×˜×™×¤×™× ×œ×™×™×¦×•×¨ ×ž×©××‘×™×?',
            '×©×“×” ×—×™×˜×” ×–×” ×”×©×§×¢×” ×˜×•×‘×” ðŸŒ¾'
        ],
        diplomatic: [
            '×ž×¦×‘ ×”×ž×©×—×§ ×ž×¢× ×™×™×Ÿ ×”×™×•×',
            '×ž×™ ×”×›×™ ×—×–×§ ×‘×©×¨×ª?',
            '×”××–×•×¨ ×”×–×” ×ª×¤×•×¡...',
            '×ž×—×¤×© ×‘×¢×œ×™ ×‘×¨×™×ª'
        ],
        threatening: [
            '×ž×™ ×¨×•×¦×” ×œ×§×¨×‘? âš”ï¸',
            '×”×¦×‘× ×©×œ×™ ×ž×©×ª×¢×ž×...',
            '×ž×—×¤×© ×™×¢×“×™× ×—×“×©×™×',
            '×–×§×•×§ ×œ××ª×’×¨'
        ],
        cooperative: [
            '×”×§×œ××Ÿ ×©×œ× ×• ×’×“×œ!',
            '×ž×—×¤×©×™× ×—×‘×¨×™× ×—×“×©×™× ×œ×§×œ××Ÿ',
            '×”×—×™×™×œ×™× ×©×œ×™ ×‘×ž×‘×¦×¨',
            '×ª×¨×ž×ª×™ ×œ××•×¦×¨ ×”×§×œ××Ÿ ×”×™×•×'
        ]
    },

    // === ACHIEVEMENT ANNOUNCEMENTS ===
    achievement: {
        all: [
            '×”×’×¢×ª×™ ×œ×¨×ž×” {level}! ðŸŽŠ',
            '×™×© ×œ×™ {territories} ×˜×¨×™×˜×•×¨×™×•×ª ×›×‘×¨!',
            'Town Hall ×¨×ž×” {townhall} ×”×•×©×œ×! ðŸ›ï¸',
            '×”×¦×‘× ×©×œ×™ ×ž×•× ×” {army} ×œ×•×—×ž×™×!',
            '×”×¦×˜×¨×¤×ª×™ ×œ×§×œ××Ÿ {clan}!',
            '×”×©×“×” ×©×œ×™ ×‘×¨×ž×” {fieldLevel} - ×™×™×¦×•×¨ ×ž×˜×•×¨×£! ðŸŒ¾',
            '{building} ×¨×ž×” {level} × ×‘× ×”!'
        ]
    },

    // === TERRITORY CONQUEST ===
    territory_conquered: {
        threatening: [
            '×›×‘×©×ª×™ ×©×“×” ×—×“×©! ×”×©×˜×— ×©×œ×™ ×’×“×œ ðŸ—ºï¸',
            '×¢×•×“ ×˜×¨×™×˜×•×¨×™×” ×‘×›×™×¡',
            '×”×¨×—×‘×ª ×”××™×ž×¤×¨×™×” × ×ž×©×›×ª'
        ],
        friendly: [
            '×ž×¦××ª×™ ×©×“×” ×ž×©××‘×™× × ×—×ž×“! ðŸŒ²',
            '×¢×•×“ ×˜×¨×™×˜×•×¨×™×” ×œ××•×¡×£'
        ],
        cooperative: [
            '×›×‘×©×ª×™ ×©×“×” ×‘×©×‘×™×œ ×”×§×œ××Ÿ',
            '×”×˜×¨×™×˜×•×¨×™×” ×”×—×“×©×” ×ž×™×™×¦×¨×ª ×¢×‘×•×¨ ×›×•×œ× ×•'
        ]
    },

    // === RESOURCE RELATED ===
    resource_shortage: {
        friendly: [
            '××•×™, × ×’×ž×¨ ×œ×™ {resource}... ðŸ˜…',
            '×ž×™×©×”×• ×™×›×•×œ ×œ×¡×—×•×¨ {resource}?',
            '×¦×¨×™×š ×“×—×•×£ {resource}!'
        ],
        diplomatic: [
            '×ž×—×¤×© {resource} - ×ž×•×›×Ÿ ×œ×©×œ× ×˜×•×‘'
        ]
    },

    resource_surplus: {
        friendly: [
            '×™×© ×œ×™ ×”×¨×‘×” {resource} ×œ×¡×—×¨!',
            '×¢×•×“×¤×™ {resource} - ×‘×•××• × ×—×œ×™×£'
        ]
    }
};

/**
 * Generate a message based on context
 */
function generateMessage(messageType, chatStyle, context = {}) {
    const templates = MESSAGE_TEMPLATES[messageType];
    if (!templates) return null;

    const styleTemplates = templates[chatStyle] || templates.all;
    if (!styleTemplates || styleTemplates.length === 0) return null;

    // Pick random template
    const template = styleTemplates[Math.floor(Math.random() * styleTemplates.length)];

    // Replace placeholders
    let message = template;
    for (const [key, value] of Object.entries(context)) {
        message = message.replace(`{${key}}`, value);
    }

    return message;
}

/**
 * Decide if AI should send a message based on frequency and context
 */
function shouldSendMessage(messageType, lastMessageTime) {
    const now = Date.now();
    const timeSinceLastMessage = now - (lastMessageTime || 0);

    const minimumIntervals = {
        random_chat: 20 * 60 * 1000,      // 20 minutes
        attack: 0,                         // Always announce attacks
        victory: 0,                        // Always announce victories
        defeat: 5 * 60 * 1000,             // 5 minutes cooldown
        trade_offer: 30 * 60 * 1000,       // 30 minutes
        achievement: 10 * 60 * 1000,       // 10 minutes
        territory_conquered: 15 * 60 * 1000 // 15 minutes
    };

    const minInterval = minimumIntervals[messageType] || 30 * 60 * 1000;
    return timeSinceLastMessage >= minInterval;
}

module.exports = {
    MESSAGE_TEMPLATES,
    generateMessage,
    shouldSendMessage
};
